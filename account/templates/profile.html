{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile | Soil Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: "class" };
  </script>

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        crossorigin="anonymous" />
</head>

<body class="bg-gray-100 dark:bg-gray-900 dark:text-gray-200 min-h-screen">

  {% include 'sidebar.html' %}

  <!-- MAIN -->
  <main class="ml-60 mt-24 flex flex-col items-center p-8 space-y-10">

    <!-- Profile Card -->
    <div class="w-full max-w-xl">
      <div class="bg-white dark:bg-gray-800/60 backdrop-blur-xl 
                  rounded-2xl p-8 shadow-xl hover:shadow-2xl 
                  transition duration-300 flex flex-col items-center">

        <form id="profileForm" method="POST" enctype="multipart/form-data"
              class="w-full flex flex-col items-center">
          {% csrf_token %}

          <!-- Profile Picture -->
          <div class="relative group w-36 h-36 mt-2">
            <img id="profilePic"
              {% if profile.profile_pic %}
                src="{{ profile.profile_pic.url }}"
              {% else %}
                src="https://www.w3schools.com/howto/img_avatar.png"
              {% endif %}
              alt="User Avatar"
              class="w-36 h-36 rounded-full border-4 border-green-500 object-cover shadow-md"/>

            <!-- Hover controls -->
            <div class="absolute inset-0 bg-black/50 rounded-full 
                        flex items-center justify-center gap-3
                        opacity-0 group-hover:opacity-100 
                        transition duration-300">
              <label for="uploadPic"
                     class="bg-blue-600 hover:bg-blue-500 text-white 
                            w-10 h-10 flex items-center justify-center 
                            rounded-full cursor-pointer">
                <i class="fas fa-upload"></i>
              </label>
              <input type="file" id="uploadPic" name="profile_pic" class="hidden" accept="image/*">

              <button id="removePic" type="button"
                      class="bg-red-600 hover:bg-red-500 text-white
                             w-10 h-10 flex items-center justify-center 
                             rounded-full">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>

          <h2 class="mt-4 text-2xl font-semibold text-gray-900 dark:text-white">
            {{ user.first_name }} {{ user.last_name }}
          </h2>
        </form>
      </div>
    </div>

    <!-- Account Info Card -->
    <div class="w-full max-w-xl">
      <div class="bg-white dark:bg-gray-800/60 backdrop-blur-xl 
                  rounded-2xl p-8 shadow-xl hover:shadow-2xl 
                  transition">

        <h3 class="text-green-600 dark:text-green-400 text-xl font-semibold flex items-center gap-2">
          <i class="fas fa-user-circle"></i> Account Info
        </h3>

        <div class="mt-6 space-y-4">

          <div class="flex justify-between pb-2 border-b border-gray-300 dark:border-gray-600">
            <span>Full Name</span>
            <span>{{ user.first_name }} {{ user.last_name }}</span>
          </div>

          <div class="flex justify-between pb-2 border-b border-gray-300 dark:border-gray-600">
            <span>Email</span>
            <span>{{ user.email }}</span>
          </div>

          <div class="flex justify-between pb-2 border-b border-gray-300 dark:border-gray-600">
            <span>Location</span>
            <span>{{ profile.location|default:"-" }}</span>
          </div>

          <div class="flex justify-between pb-2 border-b border-gray-300 dark:border-gray-600">
            <span>Joined</span>
            <span>{{ user.date_joined|date:"M d, Y" }}</span>
          </div>

        </div>
      </div>
    </div>

  </main>

  <!-- Profile Upload JS -->
  <script>
    document.getElementById("uploadPic").addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const rd = new FileReader();
        rd.onload = () => document.getElementById("profilePic").src = rd.result;
        rd.readAsDataURL(file);
        document.getElementById("profileForm").submit();
      }
    });

    document.getElementById("removePic").addEventListener("click", () => {
      $.ajax({
        url: "{% url 'account:remove_profile_pic' %}",
        method: "POST",
        headers: {"X-CSRFToken": "{{ csrf_token }}"},
        data: JSON.stringify({remove: true}),
        contentType: "application/json",
        success: () => {
          document.getElementById("profilePic").src =
            "https://www.w3schools.com/howto/img_avatar.png";
        }
      });
    });
  </script>

</body>
</html>
