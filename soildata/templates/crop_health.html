{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Crop Health Prediction</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<body class="transition-colors duration-500 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">

  {% include "sidebar.html" %}

  <div class="mt-28 max-w-2xl mx-auto p-6 rounded-2xl bg-white/80 dark:bg-gray-800 shadow-lg transition-all">
    <h1 class="text-3xl font-bold text-center text-accent mb-6">AI Crop Health Prediction</h1>

    {% if messages %}
      <div class="space-y-2 mb-4">
        {% for message in messages %}
          <div class="p-3 rounded-md {% if message.tags %} {% if 'error' in message.tags %}bg-red-100 text-red-800{% else %}bg-green-100 text-green-800{% endif %}{% else %}bg-gray-100{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
    <form method="POST" class="space-y-4">
      {% csrf_token %}

      <label class="font-semibold">Soil Type *</label>
      <select name="soil_type" required
        class="w-full px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 placeholder-gray-400 
        text-gray-900 dark:text-white focus:ring-2 focus:ring-accent outline-none shadow-sm hover:shadow-md">
        <option value="">Select Soil Type (ex: Clay, Sandy...)</option>
        {% for soil in soil_types %}
          <option value="{{ soil.id }}" {% if request.POST.soil_type == soil.id|stringformat:"s" %}selected{% endif %}>
            {{ soil.name }}
          </option>
        {% endfor %}
      </select>

      <label class="font-semibold">Crop *</label>
      <input type="text" name="crop" required placeholder="Enter Crop Name (ex: Rice, Wheat, Tomato)"
        value="{{ request.POST.crop }}"
        class="w-full px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 placeholder-gray-400
        text-gray-900 dark:text-white focus:ring-2 focus:ring-accent outline-none shadow-sm hover:shadow-md">

      <label class="font-semibold">Soil pH *</label>
      <input type="number" step="0.1" name="ph" required placeholder="Enter pH Value (ex: 6.5)"
        value="{{ request.POST.ph }}"
        class="w-full px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 placeholder-gray-400 
        text-gray-900 dark:text-white focus:ring-2 focus:ring-accent outline-none shadow-sm hover:shadow-md">

      <label class="font-semibold">Temperature (°C) *</label>
      <input type="number" step="0.1" name="temperature" required placeholder="Enter Temperature (ex: 25.0)"
        value="{{ request.POST.temperature }}"
        class="w-full px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 placeholder-gray-400 
        text-gray-900 dark:text-white focus:ring-2 focus:ring-accent outline-none shadow-sm hover:shadow-md">

      <label class="font-semibold">Moisture (%) *</label>
      <input type="number" step="0.1" name="moisture" required placeholder="Enter Soil Moisture (ex: 40.5)"
        value="{{ request.POST.moisture }}"
        class="w-full px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 placeholder-gray-400 
        text-gray-900 dark:text-white focus:ring-2 focus:ring-accent outline-none shadow-sm hover:shadow-md">

      <button type="submit"
        class="w-full py-3 px-6 bg-blue-200 text-gray-900 font-semibold rounded-xl hover:bg-accentDark 
        transition-all shadow-md hover:shadow-lg">
        Predict Crop Health
      </button>
    </form>
    {% if prediction %}
    <div class="mt-8 p-6 bg-gray-50 dark:bg-gray-900 rounded-2xl shadow-inner transition-all">
      <h2 class="text-2xl font-bold text-accent mb-4">Prediction Result:</h2>

      <p><strong>Soil Type:</strong> {{ prediction.soil_type }}</p>
      <p><strong>Crop:</strong> {{ prediction.crop }}</p>
      <p><strong>pH:</strong> {{ prediction.ph }}</p>
      <p><strong>Temperature:</strong> {{ prediction.temperature }} °C</p>
      <p><strong>Moisture:</strong> {{ prediction.moisture }}%</p>
      <p><strong>Salinity:</strong> {{ prediction.salinity }} dS/m</p>

      <div class="mt-4">
        <span class="font-semibold">Health Status:</span>
        {% if prediction.risk_level == "Healthy" %}
          <span class="px-4 py-2 rounded-full bg-green-500 text-white">Healthy</span>
        {% elif prediction.risk_level == "Moderate" %}
          <span class="px-4 py-2 rounded-full bg-yellow-400 text-white">Moderate</span>
        {% else %}
          <span class="px-4 py-2 rounded-full bg-red-600 text-white">High</span>
        {% endif %}
      </div>
    </div>
    {% endif %}

  </div>

  <!-- Theme toggle script -->
  <script>
    const html = document.documentElement;
    const toggleBtn = document.getElementById("sidebar-theme-toggle");
    const toggleIcon = document.getElementById("sidebar-theme-icon");

    if (toggleBtn && toggleIcon) {
      function updateThemeIcon() {
        if (html.classList.contains("dark")) {
          toggleIcon.classList.replace("fa-sun", "fa-moon");
        } else {
          toggleIcon.classList.replace("fa-moon", "fa-sun");
        }
      }
      updateThemeIcon();
      toggleBtn.addEventListener("click", () => {
        html.classList.toggle("dark");
        updateThemeIcon();
      });
    }
  </script>

</body>
</html>
